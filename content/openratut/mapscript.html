<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenRA Lua Tutorial - Devon Fair's e-Portfolio</title>
    <link rel="stylesheet" href="../../root/styles.css" />
</head>
<body>
    <div id="container">
        <div id="header">
            <h1>Devon Fair's e-Portfilio</h1>
        </div>
        <div id="sidebar">
            <h3><a href="../../index.html">Home</a></h3>
            <h3>Projects</h3>
            <ul>
                <li class="project">
                    <a href="../iriswar/home.html">The Iris War</a>
                    <ul class="subprojects">
                        <li><a href="../iriswar/concept.html">Concept</a></li>
                        <li><a href="../iriswar/factions.html">Factions</a></li>
                        <li><a href="../iriswar/chapters.html">Chapter List</a></li>
                        <li><a href="https://www.openra.net/">About OpenRA</a></li>
                    </ul>
                </li>
                <li class="project">
                    <a href="../dayspringone/home.html">Dayspring: Dynasties</a>
                    <ul class="subprojects">
                        <li><a href="#">Concept</a></li>
                        <li><a href="#">Character Profiles</a></li>
                        <li><a href="#">Chapter List</a></li>
                    </ul>
                </li>
                <li class="project">
                    <a href="./home.html">OpenRA Lua Tutorial</a>
                    <ul class="subprojects">
                        <li><a href="./luaintro.html">Introduction to Lua</a></li>
                        <li><a href="./ataglance.html">OpenRA's API At A Glance</a></li>
                        <li><a href="#">Making an OpenRA Script</a></li>
                        <li><a href="#">Advanced Tips and Tricks</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <div id="content">
            <h2>Making an OpenRA Script</h2>
            <p>In this section, we're go through the process of making an OpenRA mission script from start to finish. It's recommended that you go through the entire previous section first before starting this one, just so that you have a rough idea of how everything works. We're going to use a map that's already been set up for scripting, with players and actors already defined and all the map rules in place. For this, I've created a ZIP file containing an example map that you can follow along with and use as you please. You can download it <b><a href="./maps/examplemap.zip">here</a></b>. This is an RA map, so make sure you place it under <code>maps/ra</code> when you're ready to playtest the map.</p>
            <p>Chapters:</p>
            <ul>
                <li><a href="#plan">Our Plan</a></li>
                <li><a href="#mission">Laying Out The Mission</a></li>
                <li><a href="#players">Creating Player Taskforces</a></li>
                <li><a href="#enemies">Creating Enemy Taskforces</a></li>
                <li><a href="#dialogue">Mission Dialogue</a></li>
                <li><a href="#finish">Finishing Touches</a></li>
                <li><a href="#test">Testing/Debugging</a></li>
                <li><a href="#packitup">Packing It Up</a></li>
            </ul>
            <br />
            <h3 id="plan">Our Plan</h3>
            <p>First, we need to figure out what we want our map to do, and thus coming up with a plan will really help. We'll start by opening up the map folder and see what we're dealing with.</p>
            <p>Open up the ZIP file in your file explorer and you should see the following:</p>
            <img src="./images/filecontents.png" width="500" />
            <p>The Lua script will be our primary focus during this part of the tutorial, but we should also look at the two YAML files. We'll be referring back to these often when making our script, especially the map file.</p>
            <p>Extract the archive to a spot on your hard drive and then open the map file. You should see a bunch of things it:</p>
            <img src="./images/mapcontentsone.png" width="400" />
            <p>THe stuff at the top is map information. You're free to put your name (or username) in the Author spot, but the rest should stay unmodified (since all if it is being read by the mod and modifications could result in the game crashing).</p>
            <p>The spot below is what we should look at next. These are the defined players on the map (be they computer-controlled, human-controlled, or neither). I've highlighted the two that were added to the map for scripting purposes:</p>
            <img src="./images/mapcontentstwo.png" width="300" />
            <p>Let's talk about both of them.</p>
            <ul>
                <li><b>BluePlayer</b>: This is the human-controlled player. The <code>AllowBots</code> and <code>Playable</code> attributes define if the player can be controlled by the bots (in this case, no) and whether this is a human-controlled player (in this case, yes). Its faction is <i>Allies</i> with the subfaction <i>England</i>, it has no allies and its enemy is <i>RedPlayer</i>.</li>
                <li><b>RedPlayer</b>: This is our computer opponent. We've set to use OpenRA's <code>campaign</code> but, but if you want the computer opponent to act like a skirmish AI, you can also set it to a <code>normal</code> bot by replacing it in the Attributes section. Its faction is <i>Soviets</i> with the subfaction <i>Russia</i>, it has no allies and its enemy is <i>BluePlayer</i>.</li>
            </ul>
            <p>Now for the fun one: go ahead and open up the map in OpenRA by placing it in the map folder we talked about previously. Fire up OpenRA, navigate to <code>Extras -> Map Editor -> Load Map</code>, select the example map, then click <code>Load</code>. You should come to the map editor screen:</p>
            <img src="./images/ramapeditor.png" width="800" />
            <p>This is the map we have to work with. As you can see, it is pretty simple. We have a player on each side, with the human player on the bottom right and the red player on the top left, and the other two corners taken up by villages with waypoints that represent scripted events and markers. We'll get back to that last one later, but for now let's look at one of these actors.</p>
            <p>Each actor has specific properties associated with them. Specifically each actor has a <b>name, owner, location, and type</b>, all of which are displayed both in the YAML file as well as in the map editor:</p>
            <img src="./images/actorfeaturescompare.png" />
            <p>Actors are essential to the functionality to the map. This small(ish) map only has about 70 or so actors, but some maps (especially larger and more complicated ones) will likely have more than 200, 500, or in rare cases even 1000 actors, each of which play their role through custom rules and game scripts. Get ready for a ride when you get into more complicated maps as it can be a tedious process placing all of those actors...</p>
            <p>Back to the YAML file, the only other thing to note is the rules section at the bottom. This is usually just one line of code linline to a separate ruels file (as seen here) or a set of rules plopped in at the bottom of the map to change specific OpenRA rules.</p>
            <img src="./images/mapyamlrules.png" />
            <p>If we take a look at the <b>rules</b> file included in our map, there we can see that the only rule we have in place is a link to the map script we're using. This is nothing too special, but you can also define your own rules to omit or include units, chimotange the amount of starting money, whether or not random crates spawn, among other things. That RA camapign rules file that's listed before our rules file goes more in-depth, so you can check that out by going to the <a href="https://github.com/OpenRA/OpenRA"><b>OpenRA Github</b></a> or your own OpenRA installation and going to <code>mods -> ra -> rules</code> and clicking on <code>campaign-rules.yaml</code>. If you're on Linux, you're better off using the Github since the AppImage is kind of not intended to be pried into...</p>
            <img src="./images/rulescontents.png" />
            <p>So, how does all this relate to the plan we're making? Well, first we need to lay out what we want to happen - who we want to win, what we want to happen on a given part of the map, and if there's any preconditions we want to address. In this case, we already know just by looking at the map that:</p>
            <ul>
                <li>We have two players - one human-controlled and one computer-controlled.</li>
                <li>The human player has to build up their base while the computer has a base already set up.</li>
                <li>There are two villages at the corners that have waypoints for scripted events.</li>
            </ul>
            <p>Thus, the plan should probably be that we want to make a map where the human player must eliminate the computer player and, either as an added bonus or a requirement, go to the village to receive reinforcements. It's not that complex, but it should fit all of the criteria that we want out map to fulfill. For larger maps with covert-like stealth or the like, you'd want to have a larger set of criteria and a plan that fits all of those criteria, especially with computer-controlled units that are on patrol.</p>
            <p>Great, we have a plan! Let's start writing our script!</p>
            <br />
            <h3 id="mission">Laying Out the Mission</h3>
            <p>Let's finally open up that mission script and see what we have to work with:</p>
            <img src="./images/luafilefirstboot.png" width="700" />
            <p>As you can see, we're starting with pretty much a clean slate. Only <code>WorldLoaded</code> and <code>Tick</code> have been added for us, which is expected since they're the backbone of any program. Let's start by adding in those players we saw from before, like this:</p>
            <img src="./images/luaplayerlines.png" width="400"/>
            <p>We should also make our objectives while we're here. According to our plan, the end goal is for the human player to defeat the enemy computer, so we assign a promary objective to the player that tells them to destroy their computer opponent. For that we're going to use <b>AddPrimaryObjective</b>:</p>
            <img src="./images/addobjective.png" width="400" />
            <p>We should also add some functions that we will use to spawn reinforcements in the future. This will come more into play in the net chapter.</p>
            <img src="./images/blankreinforce.png" />
            <p>Finally for this section, we're going to need to mark the objective as completed when the player has done their task. Remember that to mark an objective as complete, we can use the <b>MarkCompletedObjective</b> function after specifying a player. We can add this to the <code>Tick</code> section so that it checks this condition every frame, and since out condition is thal all of Red's forces need to be eliminated, we can use the <b>HasNoRequiredUnits</b> function to specify that. When all is set and done, the <code>Tick</code> part should look like this:</p>
            <img src="./images/tickone.png" />
            <p>Alternatively, we should mark the objective as Failed if the blue player loses all their units and buildings. We can place this underneath the previous command we gave and swap the <b>MarkCompletedObjective</b> function for the <b>MarkFailedObjective</b> function. That way, it will fail theb player if they lose all their stuff instead of the enemy. Once done, your code should look like this:</p>
            <img src="./images/ticktwo.png" width="400" />
            <p>Congratulations! Our map is now functional! Fell free to jump back into the game and test it out. Try taking out the red player out and see what happens, and then try being an idiot and getting taken out yourself and see what happens. If you catch any errors, make sure to iron them out before contiunuing, because we'll bne adding more to it as we move forward, and having a functional map throughout is the most important thing for this tutorial, so remember to playtest often.</p>
            <p>Alright, time to get more involved! Let's talk about player taskforces and reinforcements!</p>
            <br />
            <h3 id="players">Creating Player Taskforces</h3>
            <p>Let's revisit one of those functions we created earlier, specifically the one for the Blue Player Reinforcements. For this map, we'll want to give the player some reinforcements when they enter the two villages at the top-right and bottom-left of the map, so let's add those in now.</p>
            <p>First, let's go back into the map editor and see what units we want to use. Go to the Actors tab and hover over a unit to see its type.</p>
            <img src="./images/onetank.png" width="300" /><br />
            <img src="./images/twotank.png" width="300" />
            <p>The <b>Light Tank</b> and <b>Medium Tank</b> in Red Alert are Allied units. These should work for what we need. Make a note of their type, as we will be using these in out script. We can also used the Ranger (also an Allied unit) if we want some anti-personnel vehiclews in our reinforcement:</p>
            <img src="./images/jeeptype.png" width="300" />
            <p>Let's create our list of vehicles as a separate variable for easier access. Add a list to your function that will list out all the vehicles that will be in the taskforce, like this:</p>
            <img src="./images/blueunits.png" width="400" />
            <p>Each entry in the list counts as a unit, so don't be afraid to add multiple of the same unit type to get a larger taskforce. In fact, this list is fairly tame for a taskforce... most maps can have a list of up to 20 units in one taskforce, depending on the situation.</p>
            <p>Now we need to be able to spawn the taskforce in. For this, we'll be using triggers and, specifically, the <b>OnEnteredProximityTrigger</b> trigger type. On our map, there are waypoints that indicate an area where, if the player enters it, the trigger should fire.</p>
            <img src="./images/reintrigone.png" width="400" />
            <p>We can use the name of this waypoint (<code>FirstReinforcementTrigger</code>) in our script without having to define it (because it's already defined as a global by the game). Let's go ahead and start making our trigger. Remember that we need to use <b>WDist</b> to define the trigger's firing radius and that we should delete the trigger at the end to avoid any memory problems. We'll need the <code>CenterPosition</code> of our waypoint and will be using both the actor and the trigger ID in our callback function. The end result should look like this:</p>
            <img src="./images/proximitytrigger.png" width="600" />

        </div>
    </div>

    <!-- Footer -->
    <footer>
        <a href="https://github.com/SteamsDev">Github</a>
        <a href="https://www.linkedin.com/in/devon-fair-84442224a">LinkedIn</a>
    </footer>

    <!-- To Top Button -->
    <button id="toTopBtn">Top</button>

    <script>
    // JavaScript to handle the scroll to top functionality
    const toTopBtn = document.getElementById('toTopBtn');

    toTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Optional: Show the button only when the user scrolls down
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 100) {
            toTopBtn.style.display = 'block';
        } else {
            toTopBtn.style.display = 'none';
        }
    });
    </script>
</body>
</html>